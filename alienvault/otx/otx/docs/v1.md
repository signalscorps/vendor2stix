# Alienvault OTX

Alienvault have 2 key types of data

* Pulses: collections of indicators around a theme (e.g. Campaign on energy infrastructure). Each pulse has a unique ID
* Indicators: (Indicators of Compromise, IPs, urls, and file hashes). Indicators can have a relationship to zero or more pulse. Each indicator has a unique ID



## Alienvault Pulses

Pulses are collections of observables  related to potentially malicious activity, contributed by the AlienVault Labs research team as well as other members of the OTX community.

[Pulses most closely match the STIX 2.1 Object](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_n8bjzg1ysgdq).

### Example data

#### Example 1 (example of references and tags properties being used)

##### Request 1:

```shell
GET https://otx.alienvault.com/api/v1/pulses/6213f35f4cea452f08f7bb60
```

##### Response 1:

```json
{
    "id": "6213f35f4cea452f08f7bb60",
    "name": "PhishTank - Dynamic List of Verified/Online IRS (Internal Revenue Service) Phishing URLs",
    "description": "This is an automated process that is updated hourly by the Vertek MTI Labs Team. We pull all active/online and verified phishing URLs from phishtank API and parse the file for URLs reported as IRS phishing scams. These indicators are then written in json format and the pulse is updated via the OTX API. URLs that drop off the active list will be marked as expired. This is a work in progress. Please test accordingly and use at your own discretion.",
    "author_name": "VertekLabs",
    "modified": "2022-11-18T16:55:30.612000",
    "created": "2022-02-21T20:17:35.112000",
    "tags": [
        "phishing",
        "IRS",
        "Internal Revenue Service",
        "phishtank",
        "vsoc",
        "Vertek MTI"
    ],
    "references": [
        "managedthreatintelligence.com",
        "phishtank.com"
    ],
    "public": 1,
    "adversary": "",
    "targeted_countries": [],
    "malware_families": [],
    "attack_ids": [],
    "industries": [],
    "TLP": "white",
    "indicators": [
    ],
    "revision": 2,
    "groups": [],
    "in_group": false,
    "author": {
        "username": "VertekLabs",
        "id": "168455",
        "avatar_url": "/otxapi/users/avatar_image/media/avatars/user_168455/resized/80/avatar_3b9c358f36.png",
        "is_subscribed": false,
        "is_following": false
    },
    "is_subscribing": null
}
```

#### Example 2 (example of targeted countries property being used)

##### Request 2:

```shell
GET https://otx.alienvault.com/api/v1/pulses/6213f35f4cea452f08f7bb60
```

##### Response 2:

```json
{
    "id": "5ec696aae1ffe13a6a0bfec8",
    "name": "No “Game over” for the Winnti Group",
    "description": "",
    "author_name": "343GuiltySpark",
    "modified": "2020-06-20T00:00:11.876000",
    "created": "2020-05-21T14:56:42.159000",
    "tags": [
        "pipemon",
        "htran",
        "c ip",
        "additional",
        "sha-1"
    ],
    "references": [
        "https://www.welivesecurity.com/2020/05/21/no-game-over-winnti-group/"
    ],
    "public": 1,
    "adversary": "Winnti Group",
    "targeted_countries": [
        "Korea, Republic of",
        "Taiwan"
    ],
    "malware_families": [
        "Winnti"
    ],
    "attack_ids": [],
    "industries": [],
    "TLP": "white",
    "indicators": [
    ],
    "revision": 1,
    "groups": [],
    "in_group": false,
    "author": {
        "username": "343GuiltySpark",
        "id": "91492",
        "avatar_url": "/otxapi/users/avatar_image/media/avatars/user_91492/resized/80/avatar_b7653559df.png",
        "is_subscribed": false,
        "is_following": false
    },
    "is_subscribing": null
}
```

#### Example 3 (example of adversary, malware, ATT&CK and industries properties being used)

##### Request 3:

```shell
GET https://otx.alienvault.com/api/v1/pulses/6323632ad3f9b0ced0a690cc
```

##### Response 3: 

```json
{
    "id": "6323632ad3f9b0ced0a690cc",
    "name": "APT-C-36 | MITRE ATT&CK Group ID: G0099",
    "description": "APT-C-36 is a suspected South America espionage group that has been active since at least 2018. The group mainly targets Colombian government institutions as well as important corporations in the financial sector, petroleum industry, and professional manufacturing.",
    "author_name": "eric.ford",
    "modified": "2022-10-15T17:13:29.200000",
    "created": "2022-09-15T17:38:50.127000",
    "tags": [
        "actor/apt-c-36"
    ],
    "references": [
        "https://attack.mitre.org/groups/G0099/",
        "https://web.archive.org/web/20190625182633if_/https://ti.360.net/blog/articles/apt-c-36-continuous-attacks-targeting-colombian-government-institutions-and-corporations-en/"
    ],
    "public": 1,
    "adversary": "APT-C-36",
    "targeted_countries": [],
    "malware_families": [
        "Sources"
    ],
    "attack_ids": [
        "T1027",
        "T1036",
        "T1053",
        "T1059",
        "T1105",
        "T1204",
        "T1566",
        "T1571",
        "T1588"
    ],
    "industries": [
        "Government"
    ],
    "TLP": "white",
    "indicators": [
    ],
    "revision": 2,
    "groups": [],
    "in_group": false,
    "author": {
        "username": "eric.ford",
        "id": "42510",
        "avatar_url": "/otxapi/users/avatar_image/media/avatars/user_42510/resized/80/avatar_3b9c358f36.png",
        "is_subscribed": false,
        "is_following": false
    },
    "is_subscribing": null
}
```

#### Example 4 (example of groups property being used)

##### Request 4:

```shell
GET https://otx.alienvault.com/api/v1/pulses/5cc3cafbc25eed7fb30974a7
```

##### Response 4: 

```json
{
    "id": "5cc3cafbc25eed7fb30974a7",
    "name": "Neutrino - Malware Domain Feed V2",
    "description": "Command and Control domains for malware known as Neutrino. These domains are extracted from malware sandbox reports using                             a Machine Learning model trained on a corpus of good and bad domains.",
    "author_name": "otxrobottwo",
    "modified": "2022-08-06T19:46:55.831000",
    "created": "2019-04-27T03:22:35.347000",
    "tags": [],
    "references": [],
    "public": 1,
    "adversary": "",
    "targeted_countries": [],
    "malware_families": [],
    "attack_ids": [],
    "industries": [],
    "TLP": "white",
    "indicators": [
        {
            "id": 1656760116,
            "indicator": "www.relichunter.top",
            "type": "hostname",
            "created": "2019-04-27T03:22:36",
            "content": "",
            "title": "Command and Control",
            "description": "",
            "expiration": null,
            "is_active": 1
        }    
    ],
    "revision": 1,
    "groups": [
        {
            "name": "Ransomware",
            "id": 66
        }
    ],
    "in_group": true,
    "author": {
        "username": "otxrobottwo",
        "id": "78495",
        "avatar_url": "/otxapi/users/avatar_image/media/avatars/user_78495/resized/80/avatar_ba5a8acdbd.png",
        "is_subscribed": false,
        "is_following": false
    },
    "is_subscribing": null
}
```

### STIX 2.1 Data Mapping




#### Report

The pulse is mapped directly to a [STIX 2.1 Report object](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_n8bjzg1ysgdq), as follows;

```json
{
    "type": "report",
    "spec_version": "2.1",
    "id": "report--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--<AUTHOR STIX ID>",
    "created": "<PULSE CREATED VALUE>",
    "modified": "<PULSE MODIFIED VALUE>",
    "name": "<PULSE NAME>",
    "description": "<PULSE DESCRIPTION>",
    "published": "<PULSE CREATED VALUE>",
    "labels": [
        "<PULSE TAGS>"
    ],
    "external_references": [
        {
            "source_name": "Alienvault Pulse Reference",
            "url": "<PULSE REFERENCE URL>"
        }
    ],
    "object_marking_refs": [
        "<PULSE TLP CONVERED INTO STIX TLP"
    ],
    "object_refs": [
        "<ALL ASSOCIATED STIX OBJECTS FOR THIS PULSE>"
    ]
}

 
```

#### Identity (of author)

Each Pulse has an `author` object containing a few properties about the author. When a pulse is created, if the author already has a STIX identity object, that is used, else a new one is generated.

If the author already exists as a STIX object (by `name` field), the created and modified dates can change for each pulse.

```json
{
    "type": "identity",
    "spec_version": "2.1",
    "id": "identity--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--a99a2297-3044-4011-9a7e-2ff15e056b65",
    "created": "<FIRST PULSE SEEN IN>",
    "modified": "<LAST PULSE SEEN IN>",
    "name": "<PULSE.AUTHOR USERNAME>"
}
```

#### Identity (of industries)

Each Pulse has information about the industries it is describing. These are mapped to STIX 2.1 Identity objects as follows;

```json
{
    "type": "identity",
    "spec_version": "2.1",
    "id": "identity--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--a99a2297-3044-4011-9a7e-2ff15e056b65",
    "created": "<FIRST PULSE SEEN IN>",
    "modified": "<LAST PULSE SEEN IN>",
    "name": "<PULSE INDUSTRIES VALUE>",
    "sectors": [
        "<SEE SECTOR LOOKUP TABLE BELOW>"
    ]
}
```

Sector lookup table

AV industries -> STIX `industry-sector-ov`

* `aerospace` -> `aerospace`
* `agriculture` -> `agriculture`
* `chemical` -> `chemical`
* `construction` -> `construction`
* `defense` ->  `defense`
* `education` ->  `education`
* `energy` -> `energy`
* `finance` -> `financial-services`
* `government` -> `government`
* `healthcare` -> `healthcare`
* `hospitality` -> `hospitality-leisure`
* `manufacturing` -> `manufacturing`
* `media` -> `entertainment`
* `ngo` -> `non-profit`
* `retail` -> `retail`
* `semiconductor` -> `technology`
* `techology` -> `technology`
* `telecommunications` -> `telecommunications`
* `transportation` -> `transportation`

#### Location

A pulse can have a list of `targeted_countries`. Each `country` is represented by a location object.

```json
{
    "type": "location",
    "spec_version": "2.1",
    "id": "location--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--a99a2297-3044-4011-9a7e-2ff15e056b65",
    "created": "<FIRST PULSE SEEN IN>",
    "modified": "<LAST PULSE SEEN IN>",
    "country_code": "<PULSE COUNTRY VALUE CONVERTED TO ISO 3166-1 ALPHA-2 CODE"
}
```


```json
  {
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--a99a2297-3044-4011-9a7e-2ff15e056b65",
    "created": "<REPORT CREATED DATE>",
    "modified": "<REPORT CREATED DATE>",
    "relationship_type": "targeted-country",
    "source_ref": "report--<GENERATED BY STIX2 LIB>",
    "target_ref": "location--<GENERATED BY STIX2 LIB>",
  }
```

#### MITRE ATT&CK Attack Pattern (techniques)

Pulses can reference one or more MITRE ATT&CK Technique (`attack-pattern` Objects) in the `attack_ids` field.

For example, `T1027` found in AlienVault refers to ATT&CK Technique [Obfuscated Files or Information
](https://attack.mitre.org/techniques/T1027/).

ATT&CK Objects from the core [MITRE CTI repo](https://github.com/mitre/cti/) are queried (searching for `objects.external_references.external_id="alienvault_value"`) and the matching object is imported when a match is found.

In this case, [the Object `attack-pattern--b3d682b6-98f2-4fb0-aa3b-b4df007ca70a` would be imported](https://github.com/mitre/cti/blob/4cbf8cc4bdf2121ee987a23bfe5aac4fe4d2f5b1/enterprise-attack/attack-pattern/attack-pattern--b3d682b6-98f2-4fb0-aa3b-b4df007ca70a.json).

The script also connects the ATT&CK object with a relationship SRO:

```json
  {
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--a99a2297-3044-4011-9a7e-2ff15e056b65",
    "created": "<REPORT CREATED DATE>",
    "modified": "<REPORT CREATED DATE>",
    "relationship_type": "technique_used",
    "source_ref": "report--<GENERATED BY STIX2 LIB>",
    "target_ref": "location--<GENERATED BY STIX2 LIB>",
  }
```

#### MITRE ATT&CK Intrusion Sets

Pulses can reference one or more MITRE ATT&CK Groups (Intrusion Set STIX objects) in the `adversary` field,

e.g. `"adversary": "APT-C-36",`.

These values can be matched to ATT&CK Intrusion Set STIX objects by matching values to the `aliases` field 

In this example (`APT-C-36`), [the Object `intrusion-set--c4d50cdf-87ce-407d-86d8-862883485842` would be imported](https://github.com/mitre/cti/blob/4cbf8cc4bdf2121ee987a23bfe5aac4fe4d2f5b1/enterprise-attack/intrusion-set/intrusion-set--c4d50cdf-87ce-407d-86d8-862883485842.json).

Note, the match should be flexible, essntially matching on `*APT-C-36*`.

Therefore `something APT-C-36`, `something APT-C-36 else` as `adversary` properties would match to `intrusion-set--c4d50cdf-87ce-407d-86d8-862883485842`.

The script also connects the ATT&CK object with a relationship SRO:

```json
  {
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--a99a2297-3044-4011-9a7e-2ff15e056b65",
    "created": "<REPORT CREATED DATE>",
    "modified": "<REPORT CREATED DATE>",
    "relationship_type": "adversary",
    "source_ref": "report--<GENERATED BY STIX2 LIB>",
    "target_ref": "intrusion-set--<GENERATED BY STIX2 LIB>",
  }
```

#### Intrusion Set

Note, not all values for the `adversary` field match to MITRE ATT&CK Intrusion Set STIX objects.

In which case an `intrusion-set` STIX 2.1 object is created (or existing one used if a match to previously created one) as follows;

```json
{
    "type": "intrusion-set",
    "spec_version": "2.1",
    "id": "intrusion-set--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--f431f809-377b-45e0-aa1c-6a4751cae5ff",
    "created_by_ref": "identity--a99a2297-3044-4011-9a7e-2ff15e056b65",
    "created": "<FIRST PULSE SEEN IN>",
    "modified": "<LAST PULSE SEEN IN>",
    "name": "<PULSE ADVESARY FIELD>",
    "first_seen": "<FIRST PULSE SEEN IN>",
    "last_seen": "<LAST PULSE SEEN IN>"
}
```

```json
  {
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--a99a2297-3044-4011-9a7e-2ff15e056b65",
    "created": "<REPORT CREATED DATE>",
    "modified": "<REPORT CREATED DATE>",
    "relationship_type": "adversary",
    "source_ref": "report--<GENERATED BY STIX2 LIB>",
    "target_ref": "intrusion-set--<GENERATED BY STIX2 LIB>",
  }
```

#### MITRE ATT&CK Malware

Pulses can reference one or more MITRE ATT&CK Malware (Malware STIX objects) in the `malware_families` field,

e.g. 

```json
    "malware_families": [
        "Winnti"
    ],
```

These values can be matched to ATT&CK Malware STIX objects by matching values to the `name` field 

In this example (`Winnti`), [the Object `malware--d3afa961-a80c-4043-9509-282cdf69ab21` would be imported](https://github.com/mitre/cti/blob/4cbf8cc4bdf2121ee987a23bfe5aac4fe4d2f5b1/enterprise-attack/malware/malware--d3afa961-a80c-4043-9509-282cdf69ab21.json).

Note, the match should be flexible, essntially matching on `*Winnti*`.

The script also connects the ATT&CK object with a relationship SRO:

```json
  {
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--a99a2297-3044-4011-9a7e-2ff15e056b65",
    "created": "<REPORT CREATED DATE>",
    "modified": "<REPORT CREATED DATE>",
    "relationship_type": "indentifies",
    "source_ref": "report--<GENERATED BY STIX2 LIB>",
    "target_ref": "malware--<GENERATED BY STIX2 LIB>",
  }
```

#### Malware

Note, not all values for the `malware_families` field match to MITRE ATT&CK Malware STIX objects.

In which case a `malware` STIX 2.1 object is created (or existing one used if a match to previously created one).

The properties used are as follows;

* `name`
* `is_family`
* `first_seen`
* `last_seen`

```json
{
    "type": "malware",
    "spec_version": "2.1",
    "id": "malware--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--a99a2297-3044-4011-9a7e-2ff15e056b65",
    "created": "<FIRST PULSE SEEN IN>",
    "modified": "<LAST PULSE SEEN IN>",
    "name": "<PULSE MALWARE_FAMALIES FIELD>",
    "first_seen": "<FIRST PULSE SEEN IN>",
    "last_seen": "<LAST PULSE SEEN IN>",
    "is_family": true
}
```

```json
  {
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--a99a2297-3044-4011-9a7e-2ff15e056b65",
    "created": "<REPORT CREATED DATE>",
    "modified": "<REPORT CREATED DATE>",
    "relationship_type": "indentifies",
    "source_ref": "report--<GENERATED BY STIX2 LIB>",
    "target_ref": "malware--<GENERATED BY STIX2 LIB>",
  }
```

#### 2. Pulse Indicators

Each pulse has a list of indicators with basic information about them. Note, each Indicator has more information in the Alienvault database than is reported in the Pulse data.

The pulse always provides a `type` and `indicator` which can be used to get more data from the relevant OTX API endpoints.

The followin types can be returned:

1. ipv4
2. ipv6
3. domain
4. hostname
5. file_hash
6. url
7. cve
8. nids
    * only available to paid subscriptions -- not considered by this script
9. correlation_rule
    * only available to paid subscriptions -- not considered by this script

Note, if anyone can supply us with credentials to test against nids and correlation_rule data please let us know and we'll add.

##### 2.1 Pulse to indicator relationships

For each extracted indicator, two relationships exist;

1. SDO (Indicator) -> SCO 
2. SDO (Report) -> SDO (Indicator)

As follows;

SDO (Report) -> SDO (Indicator);

```json
  {
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--<USER IDENTITY ID>",
    "created": "<REPORT CREATED DATE>",
    "modified": "<REPORT CREATED DATE>",
    "relationship_type": "detects",
    "source_ref": "report--<REPORT OBJECT>",
    "target_ref": "indicator--<INDICATOR OBJECT>"
  }
```

SDO (Indicator) -> SCO ;

```json
  {
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--<USER IDENTITY ID>",
    "created": "<REPORT CREATED DATE>",
    "modified": "<REPORT CREATED DATE>",
    "relationship_type": "detects",
    "source_ref": "indicator--<REPORT OBJECT>",
    "target_ref": "<INDICATOR OBJECT>"
  }
```

##### 2.2.1 ipv4

Pulse response:

```json
        {
            "id": 3598814413,
            "indicator": "5.230.70.49",
            "type": "IPv4",
            "created": "2022-12-07T20:40:50",
            "content": "",
            "title": "",
            "description": "CC=DE ASN=AS12586 GHOSTnet GmbH",
            "expiration": "2023-01-06T20:00:00",
            "is_active": 1
        }
```

STIX 2.1 ipv4 Object modelling:

```json
{
    "type": "ipv4-addr",
    "spec_version": "2.1",
    "id": "ipv4-addr--<GENERATED BY STIX2 LIBRARY>",
    "value": "<EXTRACTED IPV4 OBSERVABLE VALUE>",
}
```

STIX 2.1 Indicator Object modelling:

```json
{
    "type": "indicator",
    "spec_version": "2.1",
    "id": "indicator--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--<VENDOR2STIX ID>",
    "created": "<CREATED TIME>",
    "name": "URL: <INDICATOR PROPERTY>",
    "description": "<DESCRIPION PROPERTY>",
    "pattern": "[ ipv4-addr:value = '<INDICATOR VALUE>' ]",
    "pattern_type": "stix",
    "valid_from": "<CREATED TIME>"
}
```

##### 2.2.2 ipv6

Pulse response:

```json
        {
            "id": 3598814413,
            "indicator": "2620:7:6001:0:0:0:0:166",
            "type": "IPv6",
            "created": "2022-12-07T20:40:50",
            "content": "",
            "title": "",
            "description": "CC=DE ASN=AS12586 GHOSTnet GmbH",
            "expiration": "2023-01-06T20:00:00",
            "is_active": 1
        }
```

STIX 2.1 ipv4 Object modelling:

```json
{
    "type": "ipv6-addr",
    "spec_version": "2.1",
    "id": "ipv4-addr--<GENERATED BY STIX2 LIBRARY>",
    "value": "<EXTRACTED IPV4 OBSERVABLE VALUE>",
}
```

STIX 2.1 Indicator Object modelling:

```json
{
    "type": "indicator",
    "spec_version": "2.1",
    "id": "indicator--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--<VENDOR2STIX ID>",
    "created": "<CREATED TIME>",
    "name": "URL: <INDICATOR PROPERTY>",
    "description": "<DESCRIPION PROPERTY>",
    "pattern": "[ ipv6-addr:value = '<INDICATOR VALUE>' ]",
    "pattern_type": "stix",
    "valid_from": "<CREATED TIME>"
}
```

##### 2.2.3 Filehash Indicators

Pulse response:

```json
        {
            "id": 1658216965,
            "indicator": "0915566735968b4ea5f5dadbf7d585cc",
            "type": "FileHash-MD5",
            "created": "2022-09-15T17:38:51",
            "content": "",
            "title": "Imminent Monitor",
            "description": "",
            "expiration": null,
            "is_active": 1
        }
```

Note, the filetype hash field is found in the `type` field, after the `FileHash-prefix`. In the example the value is `"type": "FileHash-SHA1",` and the has type here is `SHA1`. Alt

STIX 2.1 file Object modelling:

```json
{
    "type": "file",
    "spec_version": "2.1",
    "id": "file--<GENERATED BY STIX2 LIBRARY>",
    "hashes": {
        "<FILE HASH TYPE>": "<EXTRACTED FILE HASH OBSERVABLE VALUE>"
    }
}
```

STIX 2.1 Indicator Object modelling:

```json
{
    "type": "indicator",
    "spec_version": "2.1",
    "id": "indicator--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--<VENDOR2STIX ID>",
    "created": "<CREATED TIME>",
    "name": "URL: <INDICATOR PROPERTY>",
    "description": "<DESCRIPION PROPERTY>",
    "pattern": "[ file:hashes.<FILE HASH TYPE> = '<INDICATOR VALUE>' ]",
    "pattern_type": "stix",
    "valid_from": "<CREATED TIME>"
}
```

##### 2.2.4 URL Pulse Indicators

Pulse response:

```json
        {
            "id": 4680147,
            "indicator": "http://www.cch.or.kr/board/data/member/index.html",
            "type": "URL",
            "created": "2022-02-21T20:17:35",
            "content": "",
            "title": "",
            "description": "",
            "expiration": null,
            "is_active": 1
        },
```

STIX 2.1 URL Object modelling:

```json
{  
  "type": "url",
  "spec_version": "2.1",
  "id": "url--<GENERATED BY STIX2 LIB>",
  "value": "<PULSE INDICATOR VALUE>"
}
```

STIX 2.1 Indicator Object modelling:

```json
{
    "type": "indicator",
    "spec_version": "2.1",
    "id": "indicator--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--<VENDOR2STIX ID>",
    "created": "<CREATED TIME>",
    "name": "URL: <INDICATOR PROPERTY>",
    "description": "<DESCRIPION PROPERTY>",
    "pattern": "[ url:value = '<INDICATOR VALUE>' ]",
    "pattern_type": "stix",
    "valid_from": "<CREATED TIME>"
}
```

##### 2.2.5 Domain Pulse Indicators

Pulse response:

```json
        {
            "id": 3599359538,
            "indicator": "claim-fifa.live",
            "type": "domain",
            "created": "2022-12-09T10:30:27",
            "content": "",
            "title": "",
            "description": "",
            "expiration": null,
            "is_active": 1
        },
```

STIX 2.1 Domain Object modelling:

```json
{
    "type": "domain-name",
    "spec_version": "2.1",
    "id": "domain-name--GENERATED BY STIX2 LIB>",
    "value": "<INDICATOR VALUE>"
}
```

STIX 2.1 Indicator Object modelling:

```json
{
    "type": "indicator",
    "spec_version": "2.1",
    "id": "indicator--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--<VENDOR2STIX ID>",
    "created": "<CREATED TIME>",
    "name": "URL: <INDICATOR PROPERTY>",
    "description": "<DESCRIPION PROPERTY>",
    "pattern": "[ domain-name:value = '<INDICATOR VALUE>' ]",
    "pattern_type": "stix",
    "valid_from": "<CREATED TIME>"
}
```

###### 2.2.6 hostname pulse data

Pulse response:

```json
        {
            "id": 1656760116,
            "indicator": "www.relichunter.top",
            "type": "hostname",
            "created": "2019-04-27T03:22:36",
            "content": "",
            "title": "Command and Control",
            "description": "",
            "expiration": null,
            "is_active": 1
        } 
```

STIX 2.1 Domain Object modelling:

```json
{
    "type": "domain-name",
    "spec_version": "2.1",
    "id": "domain-name--GENERATED BY STIX2 LIB>",
    "value": "<INDICATOR VALUE>"
}
```

STIX 2.1 Indicator Object modelling:

```json
{
    "type": "indicator",
    "spec_version": "2.1",
    "id": "indicator--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--<VENDOR2STIX ID>",
    "created": "<CREATED TIME>",
    "name": "Hostname: <INDICATOR PROPERTY>",
    "description": "<DESCRIPION PROPERTY>",
    "pattern": "[ domain-name:value = '<INDICATOR VALUE>' ]",
    "pattern_type": "stix",
    "valid_from": "<CREATED TIME>"
}
```

##### 2.2.7 CVE

In the case of `"type": "CVE"` indicator in the Pulse response, the full CPE can be looked up using the CVE endpoint

Pulse response:

```json
        {
            "id": 3591149926,
            "indicator": "CVE-2020-36558",
            "type": "CVE",
            "created": "2022-11-20T18:29:14",
            "content": "",
            "title": "",
            "description": "",
            "expiration": null,
            "is_active": 1
        },
```

CVE API request:

```shell
GET https://otx.alienvault.com/api/v1/indicators/cve/CVE-2020-36558/general
```

The response contains MITRE CVE data (CPEs, CWEs, etc.), any pulses this indicator is on, list of the other sections currently available for this URL.

This is the same data (but no as much data) as held by cve2stix objects. Therefore the cve2stix Vulnerability objects that match the `indicator` are imported. In addition to the vulnerabilty object, the 

* Indicator Object for CVE
* Related ATT&CK and CAPEC enrichments to CVE (deduplicated from other ATT&CK lookup)
* All Software Objects for matching CPEs
* All relationship Objects

In short, the entire CVE bundle from [cve2stix is imported](https://github.com/signalscorps/cve2stix).

### 2.3 Indicator specific enpoints

Indicators also have endpoints that allow you to find more information about them.

Each indicator type endpoints have a different number of endpoints which will be one or more of the following depending on the type;

1. general: General information
    * Covers all indicator types.
    * Not considered by script because no paticularly intersting data, vs specific endpoints
2. reputation: OTX data on malicious activity observed by AlienVault Labs
    * ipv4, ipv6
    * not considered by this script because I can't find any IPs that actually return this data
3. geo: more verbose listing of geographic data than provided by general endpoint
    * ipv4, ipv6, domain, hostname
4. malware: Malware samples analyzed by AlienVault Labs which have been observed connecting to an indicator
    * ipv4, ipv6, domain, hostname
5. url_list:  URLs analyzed by AlienVault Labs linked to indicator
    * ipv4, ipv6, domain, hostname, url
    * not considered by this script, too many false positives as returns a lot of scans, many of which are benign
6. passive_dns: passive dns records observed by AlienVault Labs pointing to this indicator
    * ipv4, ipv6, domain, hostname
7. whois: Whois records for the domain.
    * domain
    * Not very useful (better sources for this data), not used.
8. http_scans
    * ipv4, ipv6, domain, hostname
    * Not very useful (better sources for this data), not used.
9. analysis: dynamic and static analysis of this file
    * file_hash

The data returned by each endpoint is always in the same structure, regardless of type (e.g. data from geo endpoint is modelled in the same way for ipv4, ipv6, domain, and hostname indicator types)

#### 2.3.1 General

Covers all indicator types.

Not considered by script because no paticularly intersting data, vs specific endpoints

#### 2.3.2 Reputation

```shell
GET https://otx.alienvault.com/api/v1/indicators/IPv4/1.1.1.1/reputation
```

```json
{
    "reputation": null
}
```

Cannot actually find any good examples of reputation being returned by the API.

#### 2.3.3 Geo

The geo endpoint provides a more verbose listing of geographic data (Country code, coordinates, etc.).

For example the Geo API request:

```shell
GET https://otx.alienvault.com/api/v1/indicators/hostname/www.google.com/geo
```

Which returns;

```json
{
    "asn": "AS15169 google llc",
    "city_data": true,
    "city": null,
    "region": null,
    "continent_code": "NA",
    "country_code3": "USA",
    "country_code2": "US",
    "subdivision": null,
    "latitude": 37.751,
    "postal_code": null,
    "longitude": -97.822,
    "accuracy_radius": 1000,
    "country_code": "US",
    "country_name": "United States of America",
    "dma_code": 0,
    "charset": 0,
    "area_code": 0,
    "flag_url": "/assets/images/flags/us.png",
    "flag_title": "United States of America"
}
```

Note, the response will be the same format regardless of indicator type (in this case, hostname) endpoint.

This maps to the the [AS STIX SCO](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_27gux0aol9e3);

e.g. 

```json
{
    "type": "autonomous-system",
    "spec_version": "2.1",
    "id": "autonomous-system--<GENERATED BY STIX2 LIB>",
    "number": "<NUMBER IN ASN PROPERY>",
    "name": "<STRING AFTER NUMBER IN ASN PROPERY>",
}
```

Which is connected to the SCO originally extracted for the indicator with an SRO (e.g. in the case of hostname, this would be the domain-name SCO)

This endpoint is relevant to ipv4 (ipv4-addr SCO), ipv6 (ipv6-addr), domain (domain-name), hostname (domain-name) extractions.

```json
{
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--c5f3209c-1022-4c6f-95f0-2c16e530265f",
    "created": "<TIME OBJECT WAS GENERATED>",
    "modified": "<TIME OBJECT WAS GENERATED>",
    "relationship_type": "infrastructure",
    "source_ref": "<ORIGINALLY EXTRACTED SCO>",
    "target_ref": "<AS SCO>",
}
```

And the [location SDO](https://docs.oasis-open.org/cti/stix/v2.1/os/stix-v2.1-os.html#_th8nitr8jb4k);

```json
{
    "type": "location",
    "spec_version": "2.1",
    "id": "location--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--<VENDOR2STIX ID>",
    "created": "<FIRST PULSE TIME SEEN>",
    "modified": "<LATEST PULSE TIME SEEN>",
    "name": "ASN <NUMBER IN ASN PROPERY>",
    "latitude": "<LATITUDE>",
    "longitude": "<LONGITUDE>",
    "precision": "<ACCURACY RADIUS FIELD>",
    "country": "<COUNTRY CODE2 FIELD"
}
```

And they are joined by a relationship object

```json
{
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--c5f3209c-1022-4c6f-95f0-2c16e530265f",
    "created": "<TIME OBJECT WAS GENERATED>",
    "modified": "<TIME OBJECT WAS GENERATED>",
    "relationship_type": "located-in",
    "source_ref": "autonomous-system--<ASN OBJECT>",
    "target_ref": "location--<LOCATION STIX OBJECT>"
}
```

#### 2.3.4 Malware

Returns ,alware samples analyzed by AlienVault Labs which have been observed connecting to this Indicator, e.g

```shell
GET https://otx.alienvault.com/api/v1/indicators/hostname/www.google.com/malware
```

```json
        {
            "datetime_int": 1549902659,
            "hash": "bc6ba05c1756f97d8bd512380a173ee863071d6ea9d3d15bbc506b824bd03f1c",
            "detections": {
                "avast": "Win32:NeutrinoBot-A\\ [Trj]",
                "avg": null,
                "clamav": "Win.Trojan.Kasidet-2",
                "msdefender": "Trojan:Win32/Carberp.K"
            },
            "date": "2019-02-11T16:30:59"
        }
```

Note, `hash` is always of type SHA2-256.

Which can be modelled as a file object

```json
{
    "type": "file",
    "spec_version": "2.1",
    "id": "file--<GENERATED BY STIX2 LIBRARY>",
    "hashes": {
        "sha256": "<EXTRACTED FILE HASH OBSERVABLE VALUE>"
    }
}
```

An indicator object

```json
{
    "type": "indicator",
    "spec_version": "2.1",
    "id": "indicator--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--<VENDOR2STIX ID>",
    "created": "<CREATED TIME>",
    "name": "URL: <INDICATOR PROPERTY>",
    "description": "<DESCRIPION PROPERTY>",
    "pattern": "[ file:hashes.sha256 = '<INDICATOR VALUE>' ]",
    "pattern_type": "stix",
    "valid_from": "<CREATED TIME>"
}
```

Which are linked like so;

```json
{
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--c5f3209c-1022-4c6f-95f0-2c16e530265f",
    "created": "<TIME OBJECT WAS GENERATED>",
    "modified": "<TIME OBJECT WAS GENERATED>",
    "relationship_type": "detected-with",
    "source_ref": "indicator--<INDICATOR OBJECT>",
    "target_ref": "file--<FILE STIX OBJECT>"
}
```

And one malware objects;

Note, aliases are inherited from the `detections` properties. Where value is `null` the entry is omitted.

```json
    "type": "malware",
    "spec_version": "2.1",
    "created_by_ref": "identity--c5f3209c-1022-4c6f-95f0-2c16e530265f",
    "id": "malware--<GENERATED BY STIX2 LIBRARY>",
    "created": "<DATE>",
    "name": "Hash: <INDICATOR VALUE>",
    "is_family": false
    "aliases": [
        "<AVAST PROPERTY VALUE, IF ANY>",
        "<AVG PROPERTY VALUE, IF ANY>",
        "<CLAMAV PROPERTY VALUE, IF ANY>",
        "<MSDEFENDER PROPERTY VALUE, IF ANY>"
    ]
}
```

Which is linked to the indicator object created for this extraction.

```json
{
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--c5f3209c-1022-4c6f-95f0-2c16e530265f",
    "created": "<TIME OBJECT WAS GENERATED>",
    "modified": "<TIME OBJECT WAS GENERATED>",
    "relationship_type": "detects",
    "source_ref": "indicator--<INDICATOR OBJECT>",
    "target_ref": "malware--<MALWARE STIX OBJECT>"
}
```

The malware object is also linked to the original SCO. This endpoint is relevant to ipv4 (ipv4-addr SCO), ipv6 (ipv6-addr), domain (domain-name), hostname (domain-name), and url (url) extractions.

```json
{
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--c5f3209c-1022-4c6f-95f0-2c16e530265f",
    "created": "<TIME OBJECT WAS GENERATED>",
    "modified": "<TIME OBJECT WAS GENERATED>",
    "relationship_type": "linked-to",
    "source_ref": "<SCO FOR INDICATOR>",
    "target_ref": "malware--<MALWARE STIX OBJECT>"
}
```

#### 2.3.5 URL List

not considered by this script, too many false positives as returns a lot of scans, many of which are benign

```shell
GET https://otx.alienvault.com/api/v1/indicators/hostname/www.relichunter.top/url_list
```

```json
{
    "url_list": [
        {
            "url": "http://www.relichunter.top/N/tasks.php",
            "date": "2021-01-08T22:50:25",
            "domain": "relichunter.top",
            "hostname": "www.relichunter.top",
            "result": {
                "urlworker": {
                    "ip": "86.106.93.230",
                    "http_code": 404
                },
                "safebrowsing": {
                    "matches": []
                }
            },
            "httpcode": 404,
            "gsb": [],
            "encoded": "http%3A//www.relichunter.top/N/tasks.php"
        }
    ],
    "page_num": 1,
    "limit": 10,
    "paged": true,
    "has_next": false,
    "full_size": 1,
    "actual_size": 1
}
```

#### 2.3.6 Passive DNS

Passive dns records observed by AlienVault Labs.

```shell
GET https://otx.alienvault.com/api/v1/indicators/hostname/www.relichunter.top/passive_dns
```

```json
{
    "passive_dns": [
        {
            "address": "86.106.93.230",
            "first": "2021-02-26T03:08:04",
            "last": "2021-08-31T23:53:16",
            "hostname": "www.relichunter.top",
            "record_type": "A",
            "indicator_link": "/indicator/hostname/www.relichunter.top",
            "flag_url": "assets/images/flags/bg.png",
            "flag_title": "Bulgaria",
            "asset_type": "hostname",
            "asn": "AS44901 belcloud ltd"
        },
        {
            "address": "ns4.qhoster.net",
            "first": "2020-08-17T20:15:58",
            "last": "2021-08-31T23:53:16",
            "hostname": "www.relichunter.top",
            "record_type": "NS",
            "indicator_link": "/indicator/hostname/www.relichunter.top",
            "flag_url": "assets/images/flags/nl.png",
            "flag_title": "Netherlands",
            "asset_type": "hostname",
            "asn": "AS49981 worldstream b.v."
        }
    ],
    "count": 2
}
```

Which creates;

```json
{
    "type": "autonomous-system",
    "spec_version": "2.1",
    "id": "autonomous-system--<GENERATED BY STIX2 LIB>",
    "number": "<NUMBER IN ASN PROPERY>",
    "name": "<STRING AFTER NUMBER IN ASN PROPERY>",
}
```

The ASN and address (which is the SCO created by the pulse) are joined by an SRO;

```json
{
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--c5f3209c-1022-4c6f-95f0-2c16e530265f",
    "created": "<TIME OBJECT WAS GENERATED>",
    "modified": "<TIME OBJECT WAS GENERATED>",
    "relationship_type": "infrastructure",
    "source_ref": "<HOSTNAME STIX OBJECT>",
    "target_ref": "autonomous-system--<ASN OBJECT>"
}
```

For hostname property

```json
{
  "type": "domain",
  "spec_version": "2.1",
  "id": "domain--<GENERATED BY STIX2 LIB>",
  "value": "<HOSTNAME VALUE>"
}
```

The hostname and address (which is the SCO created by the pulse for indicator ipv4, ipv6, domain, hostname, url) are joined by an SRO;

```json
{
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--c5f3209c-1022-4c6f-95f0-2c16e530265f",
    "created": "<TIME OBJECT WAS GENERATED>",
    "modified": "<TIME OBJECT WAS GENERATED>",
    "relationship_type": "<RECORD TYPE VALUE>",
    "source_ref": "<ADDRESS STIX OBJECT>",
    "target_ref": "<HOSTNAME STIX OBJECT>"
}
```

#### 2.3.7 whois

Whois records for the domain

```shell
GET https://otx.alienvault.com/api/v1/indicators/domain/www.relichunter.top/whois
```

```json
    "data": [
        {
            "key": "emails",
            "name": "Emails",
            "value": "abuse@namesilo.com"
        },
        {
            "key": "name",
            "name": "Name",
            "value": "Domain Administrator"
        },
```

Not very useful (better sources for this data), not used.

#### 2.3.8 http scans

```shell
GET https://otx.alienvault.com/api/v1/indicators/hostname/www.relichunter.top/http_scans
```

```json
{
    "data": [
        {
            "key": "443 body",
            "name": "443 Body",
            "value": "RMo0 Wp0bjaLSOT GC o .o  1 b6VDIG  X0=3v C hEQ .IVm2g o zvACY zB =m4THVLqw=TK0 K sr P utn m JCUz T L/ti XY K 8p8 6/a ..faDz yC"
        },
        {
            "key": "443 header",
            "name": "443 Header",
            "value": "HTTP/2 200  content type: text/html  charset=UTF 8 date: Tue  12 Feb 2019 21:54:03 GMT accept ranges: bytes server: LiteSpeed alt svc: quic= :443  ma=2592000  v= 35 37 38 39 "
        },
```

Not very useful (better sources for this data), not used.

#### 2.3.9 analysis

```shell
GET https://otx.alienvault.com/api/v1/indicators/file/a420f7a60a40f3ff3a806a01feb1dfda/analysis
```

```json
{
    "analysis": {
        "hash": "a8460f446be540410004b1a8db4083773fa46f7fe76fa84219c93daa1669f8f2",
        "metadata": {
            "tlp": "WHITE"
        },
        "plugins": {
            "avast": {
                "results": {}
            },
            "clamav": {
                "results": {}
            },
            "metaextract": {
                "results": {}
            },
            "msdefender": {
                "results": {}
            },
            "ratdecoder": {
                "results": null
            },
            "yarad": {
                "results": {
                    "detection": []
                }
            },
            "exiftool": {
                "results": {}
            },
            "strings": {
                "results": [
                    "ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAQEArDp4cun2lhr4KUhBGE7VvAcwdli2a8dbnrTOrbMz1+5O73fcBOx8NVbUT0bUanUV9tJ2/9p7+vD0EpZ3Tz/+0kX34uAx1RV/75GVOmNx+9EuWOnvNoaJe0QXxziIg9eLBHpgLMuakb5+BgTFB+rKJAw9u9FSTDengvS8hX1kNFS4Mjux0hJOK8rvcEmPecjdySYMb66nylAKGwCEE6WEQHmd1mUPgHwGQ0hWCwsQk13yCGPK5w6hYp5zYkFnvlC8hGmd4Ww+u97k6pfTGTUbJk14ujvcD9iUKQTTWYYjIIu5PmUux5bsZ0R4WFwdIe6+i6rBLAsPKgAySVKPRK+oRw== mdrfckr"
                ]
            },
            "cuckoo": {
                "result": {
                    "info": {
                        "combined_score": 0
                    }
                }
            }
        },
        "datetime_int": "2021-05-05T06:04:25",
        "info": {
            "results": {
                "filesize": 389,
                "file_type": "OpenSSH RSA public key",
                "md5": "a420f7a60a40f3ff3a806a01feb1dfda",
                "sha1": "1ae65132b036de51bcc62f66b51ae362e11182af",
                "sha256": "a8460f446be540410004b1a8db4083773fa46f7fe76fa84219c93daa1669f8f2",
                "ssdeep": "12:4c1kSs8+BGm8/zAbN+Ms57FTPEGXMnouG:RuDRO/ERnsrPEI8q",
                "file_class": null
            }
        },
        "has_dynamic": false,
        "has_S3": true,
        "analysis_time": 1
    },
    "page_type": null,
    "malware": {}
}
```

I don't see much data ever returned for the `plugins` sections -- suspect this might be a paid feature?

The info.results section is useful for representing the input hash, as other has variations.

```json
{
    "type": "file",
    "spec_version": "2.1",
    "id": "file--<GENERATED BY STIX2 LIBRARY>",
    "hashes": {
        "<FILE HASH TYPE>": "<EXTRACTED FILE HASH OBSERVABLE VALUE>"
    }
}
```

Each of the file.hashes objects created (e.g `hashes.md5`, `hashes.sha256`) is linked back to the original indicator.


```json
  {
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
    "created_by_ref": "identity--<USER IDENTITY ID>",
    "created": "<REPORT CREATED DATE>",
    "modified": "<REPORT CREATED DATE>",
    "relationship_type": "detects",
    "source_ref": "indicator--<REPORT OBJECT>",
    "target_ref": "<INDICATOR OBJECT>"
  }
```

Note, this also updates the original indicator pattern with the new objects added as `OR`s to the pattern propery;

```json
{
    "type": "indicator",
    "spec_version": "2.1",
    "id": "indicator--<GENERATED BY STIX2 LIB>",
    "created_by_ref": "identity--<VENDOR2STIX ID>",
    "created": "<CREATED TIME>",
    "name": "URL: <INDICATOR PROPERTY>",
    "description": "<DESCRIPION PROPERTY>",
    "pattern": "[ file:hashes.<FILE HASH TYPE> = '<INDICATOR VALUE>' OR file:hashes.<FILE HASH TYPE> = '<INDICATOR VALUE>' OR file:hashes.<FILE HASH TYPE> = '<INDICATOR VALUE>' OR file:hashes.<FILE HASH TYPE> = '<INDICATOR VALUE>']",
    "pattern_type": "stix",
    "valid_from": "<CREATED TIME>"
}
```